{% extends '_base.html' %}
{% load static %}
{% load i18n %}

{% block title %}
  {{ post.title }} | Gabriel Yusubov
{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="{% static 'css/blog_article_details.css' %}" />
{% endblock %}

{% block meta %}
  {% with desc=post.content|striptags|truncatechars:200 %}
    <meta name="description" content="{{ desc }}">
  {% endwith %}
  <meta name="keywords" content="{% trans 'Gabriel Yusubov, блог, статья, коллекции, мода, дизайн' %}">
  <meta name="author" content="Gabriel Yusubov">
  <meta name="robots" content="index, follow">

  <meta property="og:type" content="article">
  <meta property="og:site_name" content="Gabriel Yusubov">
  <meta property="og:title" content="{{ post.title }}">
  <meta property="og:description" content="{{ post.content|striptags|truncatechars:200 }}">
  <meta property="og:url" content="{% firstof canonical_url request.build_absolute_uri %}">
  {% if post.preview %}
    <meta property="og:image" content="{{ request.build_absolute_uri }}{{ post.preview.url }}">
  {% else %}
    <meta property="og:image" content="{{ request.build_absolute_uri|cut:request.path }}{% static 'images/GY.png' %}">
  {% endif %}
  <meta property="og:locale" content="{{ CURR|default:'ru' }}_{% if CURR == 'ru' %}RU{% else %}US{% endif %}">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ post.title }}">
  <meta name="twitter:description" content="{{ post.content|striptags|truncatechars:200 }}">
  {% if post.preview %}
    <meta name="twitter:image" content="{{ request.build_absolute_uri }}{{ post.preview.url }}">
  {% else %}
    <meta name="twitter:image" content="{{ request.build_absolute_uri|cut:request.path }}{% static 'images/GY.png' %}">
  {% endif %}
{% endblock meta %}



<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "{{ post.title|escapejs }}",
  {% if post.preview %}
  "image": ["{{ request.build_absolute_uri }}{{ post.preview.url }}"],
  {% endif %}
  "datePublished": "{{ post.created_at|date:'c' }}",
  "dateModified": "{{ post.updated_at|date:'c' }}",
  "author": {
    "@type": "Organization",
    "name": "Gabriel Yusubov"
  }
}
</script>



{% block content %}
  <div class="status-bar" role="navigation" aria-label="{% trans 'Статус-бар' %}">
    <div class="sb-inner">
      <a href="{% url 'home' %}"><img class="sb-logo" src="{% static 'images/GY.svg' %}" alt="GY" /></a>
      <span class="sb-dot" aria-hidden="true"></span>
      <a class="sb-link" href="{% url 'blog' %}">{% trans "БЛОГ" %}</a>
      <span class="sb-dot" aria-hidden="true"></span>
      <a class="sb-link" href="{% url 'post' post.slug %}">{{ post.title }}</a>
    </div>
  </div>

  <main>
    <section class="article">
      <div class="article-cover">
        {% if post.preview %}
          <img src="{{ post.preview.url }}" alt="{{ post.title }}" />
        {% endif %}
      </div>

      <div class="article-inner">
        <header class="article-head">
          <a href="{% url 'blog' %}" class="article-back"><img src="{% static 'icons/arrow_back.svg' %}" alt="Назад" /></a>

          <h1 class="article-title">{{ post.title }}</h1>
          <time class="article-date" datetime="{{ post.created_at|date:'Y-m-d' }}">{{ post.created_at|date:'d / m / Y' }}</time>
        </header>

        <div class="article-body">{{ post.content|safe }}</div>

        <div class="article-divider"></div>
      </div>

      <section class="article-more">
        <button class="more-btn prev" aria-label="{% trans 'Предыдущая' %}"><img src="{% static 'icons/arrow.svg' %}" alt="" /></button>

        <div class="more-track">
          {% for p in more_posts %}
            <a class="more-card" href="{{ p.get_absolute_url }}">
              <div class="more-thumb">
                {% if p.preview %}
                  <img src="{{ p.preview.url }}" alt="{{ p.title }}" />
                {% endif %}
              </div>
              <div class="more-info">
                <div class="more-title">{{ p.title }}</div>
                <time class="more-date" datetime="{{ p.created_at|date:'Y-m-d' }}">{{ p.created_at|date:'d / m / Y' }}</time>
              </div>
            </a>
          {% empty %}
            <div class="more-empty">{% trans "Других постов пока нет" %}</div>
          {% endfor %}
        </div>

        <button class="more-btn next" aria-label="{% trans 'Следующая' %}"><img src="{% static 'icons/arrow.svg' %}" alt="" /></button>
      </section>
    </section>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const track = document.querySelector('.more-track')
      const cards = Array.from(document.querySelectorAll('.more-card'))
      const prev = document.querySelector('.more-btn.prev')
      const next = document.querySelector('.more-btn.next')
      if (!track || cards.length === 0) return
    
      const gap = () => parseFloat(getComputedStyle(track).gap) || 0
      const cardW = () => cards[0].getBoundingClientRect().width
      const step = () => cardW() + gap()
    
      const visible = () => {
        const w = track.getBoundingClientRect().width
        const cw = cardW()
        const g = gap()
        const n = Math.max(1, Math.floor((w + g) / (cw + g)))
        return Math.min(n, cards.length)
      }
    
      const lastStart = () => Math.max(0, cards.length - visible())
    
      let index = 0
    
      function go(i) {
        index = i
        track.scrollTo({ left: Math.round(index * step()), behavior: 'smooth' })
      }
    
      prev.addEventListener('click', () => {
        go(index <= 0 ? lastStart() : index - 1)
      })
    
      next.addEventListener('click', () => {
        go(index >= lastStart() ? 0 : index + 1)
      })
    
      let rid
      const onResize = () => {
        cancelAnimationFrame(rid)
        rid = requestAnimationFrame(() => go(Math.min(index, lastStart())))
      }
      window.addEventListener('resize', onResize, { passive: true })
    })
  </script>
{% endblock %}
