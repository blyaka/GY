{% extends '_base.html' %}
{% load static %}
{% load site_settings %}
{% get_site_contacts as s %}
{% load i18n %}

{% block title %}{% trans "Регистрация" %} | Gabriel Yusubov{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="{% static 'css/registration.css' %}" />
{% endblock %}

{% block content %}
  <div class="status-bar" role="navigation" aria-label="{% trans 'Статус-бар' %}">
    <div class="sb-inner">
      <a href="{% url 'home' %}">
        <img class="sb-logo" src="{% static 'images/GY.svg' %}" alt="GY">
      </a>
      <span class="sb-dot" aria-hidden="true"></span>
      <a class="sb-link" href="{% url 'account_signup' %}">{% trans "РЕГИСТРАЦИЯ" %}</a>
    </div>
  </div>

  <main>
    <section class="auth">
      <div class="auth-wrap">
        <img class="auth-logo" src="{% static 'images/GY.svg' %}" alt="GY" />
        <h1 class="auth-title">{% trans "Регистрационная форма" %}</h1>

        {% if form.errors %}
          <div class="auth-error-list">
            <ul>
              {% for field, errors in form.errors.items %}
                {% for error in errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              {% endfor %}
              {% for error in form.non_field_errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}

        <form class="auth-form" method="post" action="{% url 'account_signup' %}" novalidate>
          {% csrf_token %}

          <div class="form-row">
            <label for="id_full_name">{% trans "ФИО" %}:</label>
            <input type="text" id="id_full_name" name="full_name" value="{{ form.full_name.value|default:'' }}" required />
          </div>

          <div class="form-row">
            <label for="id_email">Email:</label>
            <input type="email" id="id_email" name="email" value="{{ form.email.value|default:'' }}" required />
          </div>

          <div class="form-row password-row">
            <label for="id_password1">{% trans "Пароль" %}:</label>
            <div class="password-wrapper">
              <input type="password" id="id_password1" name="password1" required />
              <label class="pw-toggle" aria-label="{% trans 'Показать пароль' %}">
                <input type="checkbox" id="eye1" />
                <!-- SVGs как у тебя -->
                <svg class="eye" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="..."/></svg>
                <svg class="eye-slash" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="..."/></svg>
              </label>
            </div>
          </div>

          <div class="form-row password-row">
            <label for="id_password2">{% trans "Повторите пароль" %}:</label>
            <div class="password-wrapper">
              <input type="password" id="id_password2" name="password2" required />
              <label class="pw-toggle" aria-label="{% trans 'Показать пароль' %}">
                <input type="checkbox" id="eye2" />
                <!-- SVGs как у тебя -->
                <svg class="eye" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="..."/></svg>
                <svg class="eye-slash" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="..."/></svg>
              </label>
            </div>
          </div>

          <div class="remember-row">
            <label class="remember">
              <input type="checkbox" name="remember" checked required />
              <span class="check"></span>
              <span>
                {% blocktrans trimmed %}
                Нажимая кнопку «Зарегистрироваться», я даю своё согласие на обработку персональных данных в соответствии с Федеральным законом от 27.07.2006 № 152-ФЗ «О персональных данных».
                {% endblocktrans %}
              </span>
            </label>
          </div>

          <div class="btn-row">
            <button type="submit" class="auth-btn">{% trans "ЗАРЕГИСТРИРОВАТЬСЯ" %}</button>
          </div>

          {% url 'account_login' as login_url %}
          <p class="auth-note">
            {% blocktrans trimmed with login_url=login_url %}
            Если у вас уже есть аккаунт, то просто <br>
            <a class="reg-link" href="{{ login_url }}">авторизуйтесь на сайте</a>.
            {% endblocktrans %}
          </p>
        </form>
      </div>
    </section>
  </main>

<script>
  window.gettext = window.gettext || (s => s);

  const form = document.querySelector('form');
  form.addEventListener('submit', (e) => {
    const agree = form.querySelector('input[name="remember"]');
    if (!form.checkValidity() || !agree.checked) {
      e.preventDefault();
      if (!agree.checked) {
        agree.setCustomValidity(gettext('Нужно согласие на обработку персональных данных.'));
      }
      form.reportValidity();
      agree.setCustomValidity('');
      return;
    }
  });
</script>

<script>
  ;(function () {
    const p1 = document.getElementById('id_password1');
    const p2 = document.getElementById('id_password2');
    const e1 = document.getElementById('eye1');
    const e2 = document.getElementById('eye2');

    e1.checked = false;
    e2.checked = false;
    p1.type = 'password';
    p2.type = 'password';

    e1.addEventListener('change', () => { p1.type = e1.checked ? 'text' : 'password' });
    e2.addEventListener('change', () => { p2.type = e2.checked ? 'text' : 'password' });
  })();
</script>
{% endblock %}
